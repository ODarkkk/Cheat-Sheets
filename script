#!/bin/bash

FILE="$HOME/cheatsheets.md"

if [ ! -f "$FILE" ]; then
  echo "Cheatsheet file not found: $FILE"
  exit 1
fi

if [ -z "$1" ]; then
  less "$FILE"
  exit 0
fi

SEARCH="$1"

awk -v term="$SEARCH" '
BEGIN { 
  printing=0
  target_level=0
}
/^#+/ {
  level = length($1)  # Count # characters
  if (tolower($0) ~ tolower(term)) {
    printing=1
    target_level=level
    print
    next
  }
  if (printing && level <= target_level) {
    exit
  }
}
printing { print }
' "$FILE"
